{"version":3,"file":"index58.js","sources":["../../../node_modules/.pnpm/@pixi+core@7.4.3/node_modules/@pixi/core/lib/mask/StencilSystem.mjs"],"sourcesContent":["import { ExtensionType, extensions } from \"@pixi/extensions\";\nimport { settings } from \"@pixi/settings\";\nimport { AbstractMaskSystem } from \"./AbstractMaskSystem.mjs\";\nclass StencilSystem extends AbstractMaskSystem {\n  /**\n   * @param renderer - The renderer this System works for.\n   */\n  constructor(renderer) {\n    super(renderer), this.glConst = settings.ADAPTER.getWebGLRenderingContext().STENCIL_TEST;\n  }\n  getStackLength() {\n    const maskData = this.maskStack[this.maskStack.length - 1];\n    return maskData ? maskData._stencilCounter : 0;\n  }\n  /**\n   * Applies the Mask and adds it to the current stencil stack.\n   * @param maskData - The mask data\n   */\n  push(maskData) {\n    const maskObject = maskData.maskObject, { gl } = this.renderer, prevMaskCount = maskData._stencilCounter;\n    prevMaskCount === 0 && (this.renderer.framebuffer.forceStencil(), gl.clearStencil(0), gl.clear(gl.STENCIL_BUFFER_BIT), gl.enable(gl.STENCIL_TEST)), maskData._stencilCounter++;\n    const colorMask = maskData._colorMask;\n    colorMask !== 0 && (maskData._colorMask = 0, gl.colorMask(!1, !1, !1, !1)), gl.stencilFunc(gl.EQUAL, prevMaskCount, 4294967295), gl.stencilOp(gl.KEEP, gl.KEEP, gl.INCR), maskObject.renderable = !0, maskObject.render(this.renderer), this.renderer.batch.flush(), maskObject.renderable = !1, colorMask !== 0 && (maskData._colorMask = colorMask, gl.colorMask(\n      (colorMask & 1) !== 0,\n      (colorMask & 2) !== 0,\n      (colorMask & 4) !== 0,\n      (colorMask & 8) !== 0\n    )), this._useCurrent();\n  }\n  /**\n   * Pops stencil mask. MaskData is already removed from stack\n   * @param {PIXI.DisplayObject} maskObject - object of popped mask data\n   */\n  pop(maskObject) {\n    const gl = this.renderer.gl;\n    if (this.getStackLength() === 0)\n      gl.disable(gl.STENCIL_TEST);\n    else {\n      const maskData = this.maskStack.length !== 0 ? this.maskStack[this.maskStack.length - 1] : null, colorMask = maskData ? maskData._colorMask : 15;\n      colorMask !== 0 && (maskData._colorMask = 0, gl.colorMask(!1, !1, !1, !1)), gl.stencilOp(gl.KEEP, gl.KEEP, gl.DECR), maskObject.renderable = !0, maskObject.render(this.renderer), this.renderer.batch.flush(), maskObject.renderable = !1, colorMask !== 0 && (maskData._colorMask = colorMask, gl.colorMask(\n        (colorMask & 1) !== 0,\n        (colorMask & 2) !== 0,\n        (colorMask & 4) !== 0,\n        (colorMask & 8) !== 0\n      )), this._useCurrent();\n    }\n  }\n  /**\n   * Setup renderer to use the current stencil data.\n   * @private\n   */\n  _useCurrent() {\n    const gl = this.renderer.gl;\n    gl.stencilFunc(gl.EQUAL, this.getStackLength(), 4294967295), gl.stencilOp(gl.KEEP, gl.KEEP, gl.KEEP);\n  }\n}\nStencilSystem.extension = {\n  type: ExtensionType.RendererSystem,\n  name: \"stencil\"\n};\nextensions.add(StencilSystem);\nexport {\n  StencilSystem\n};\n//# sourceMappingURL=StencilSystem.mjs.map\n"],"names":["StencilSystem","AbstractMaskSystem","renderer","settings","maskData","maskObject","gl","prevMaskCount","colorMask","ExtensionType","extensions"],"mappings":";;;;AAGA,MAAMA,UAAsBC,EAAmB;AAAA;AAAA;AAAA;AAAA,EAI7C,YAAYC,GAAU;AACpB,UAAMA,CAAQ,GAAG,KAAK,UAAUC,EAAS,QAAQ,yBAA0B,EAAC;AAAA,EAC7E;AAAA,EACD,iBAAiB;AACf,UAAMC,IAAW,KAAK,UAAU,KAAK,UAAU,SAAS,CAAC;AACzD,WAAOA,IAAWA,EAAS,kBAAkB;AAAA,EAC9C;AAAA;AAAA;AAAA;AAAA;AAAA,EAKD,KAAKA,GAAU;AACb,UAAMC,IAAaD,EAAS,YAAY,EAAE,IAAAE,EAAE,IAAK,KAAK,UAAUC,IAAgBH,EAAS;AACzF,IAAAG,MAAkB,MAAM,KAAK,SAAS,YAAY,aAAY,GAAID,EAAG,aAAa,CAAC,GAAGA,EAAG,MAAMA,EAAG,kBAAkB,GAAGA,EAAG,OAAOA,EAAG,YAAY,IAAIF,EAAS;AAC7J,UAAMI,IAAYJ,EAAS;AAC3B,IAAAI,MAAc,MAAMJ,EAAS,aAAa,GAAGE,EAAG,UAAU,IAAI,IAAI,IAAI,EAAE,IAAIA,EAAG,YAAYA,EAAG,OAAOC,GAAe,UAAU,GAAGD,EAAG,UAAUA,EAAG,MAAMA,EAAG,MAAMA,EAAG,IAAI,GAAGD,EAAW,aAAa,IAAIA,EAAW,OAAO,KAAK,QAAQ,GAAG,KAAK,SAAS,MAAM,MAAO,GAAEA,EAAW,aAAa,IAAIG,MAAc,MAAMJ,EAAS,aAAaI,GAAWF,EAAG;AAAA,OACtVE,IAAY,OAAO;AAAA,OACnBA,IAAY,OAAO;AAAA,OACnBA,IAAY,OAAO;AAAA,OACnBA,IAAY,OAAO;AAAA,IAC1B,IAAQ,KAAK;EACV;AAAA;AAAA;AAAA;AAAA;AAAA,EAKD,IAAIH,GAAY;AACd,UAAMC,IAAK,KAAK,SAAS;AACzB,QAAI,KAAK,eAAc,MAAO;AAC5B,MAAAA,EAAG,QAAQA,EAAG,YAAY;AAAA,SACvB;AACH,YAAMF,IAAW,KAAK,UAAU,WAAW,IAAI,KAAK,UAAU,KAAK,UAAU,SAAS,CAAC,IAAI,MAAMI,IAAYJ,IAAWA,EAAS,aAAa;AAC9I,MAAAI,MAAc,MAAMJ,EAAS,aAAa,GAAGE,EAAG,UAAU,IAAI,IAAI,IAAI,EAAE,IAAIA,EAAG,UAAUA,EAAG,MAAMA,EAAG,MAAMA,EAAG,IAAI,GAAGD,EAAW,aAAa,IAAIA,EAAW,OAAO,KAAK,QAAQ,GAAG,KAAK,SAAS,MAAM,MAAO,GAAEA,EAAW,aAAa,IAAIG,MAAc,MAAMJ,EAAS,aAAaI,GAAWF,EAAG;AAAA,SACjSE,IAAY,OAAO;AAAA,SACnBA,IAAY,OAAO;AAAA,SACnBA,IAAY,OAAO;AAAA,SACnBA,IAAY,OAAO;AAAA,MAC5B,IAAU,KAAK;IACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAKD,cAAc;AACZ,UAAMF,IAAK,KAAK,SAAS;AACzB,IAAAA,EAAG,YAAYA,EAAG,OAAO,KAAK,eAAgB,GAAE,UAAU,GAAGA,EAAG,UAAUA,EAAG,MAAMA,EAAG,MAAMA,EAAG,IAAI;AAAA,EACpG;AACH;AACAN,EAAc,YAAY;AAAA,EACxB,MAAMS,EAAc;AAAA,EACpB,MAAM;AACR;AACAC,EAAW,IAAIV,CAAa;","x_google_ignoreList":[0]}