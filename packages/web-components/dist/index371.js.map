{"version":3,"file":"index371.js","sources":["../../../node_modules/.pnpm/pixi.js@8.8.1/node_modules/pixi.js/lib/assets/loader/workers/WorkerManager.mjs"],"sourcesContent":["import WorkerInstance from '../../../_virtual/checkImageBitmap.worker.mjs';\nimport WorkerInstance$1 from '../../../_virtual/loadImageBitmap.worker.mjs';\n\n\"use strict\";\nlet UUID = 0;\nlet MAX_WORKERS;\nclass WorkerManagerClass {\n  constructor() {\n    this._initialized = false;\n    this._createdWorkers = 0;\n    this._workerPool = [];\n    this._queue = [];\n    this._resolveHash = {};\n  }\n  isImageBitmapSupported() {\n    if (this._isImageBitmapSupported !== void 0)\n      return this._isImageBitmapSupported;\n    this._isImageBitmapSupported = new Promise((resolve) => {\n      const { worker } = new WorkerInstance();\n      worker.addEventListener(\"message\", (event) => {\n        worker.terminate();\n        WorkerInstance.revokeObjectURL();\n        resolve(event.data);\n      });\n    });\n    return this._isImageBitmapSupported;\n  }\n  loadImageBitmap(src, asset) {\n    return this._run(\"loadImageBitmap\", [src, asset?.data?.alphaMode]);\n  }\n  async _initWorkers() {\n    if (this._initialized)\n      return;\n    this._initialized = true;\n  }\n  _getWorker() {\n    if (MAX_WORKERS === void 0) {\n      MAX_WORKERS = navigator.hardwareConcurrency || 4;\n    }\n    let worker = this._workerPool.pop();\n    if (!worker && this._createdWorkers < MAX_WORKERS) {\n      this._createdWorkers++;\n      worker = new WorkerInstance$1().worker;\n      worker.addEventListener(\"message\", (event) => {\n        this._complete(event.data);\n        this._returnWorker(event.target);\n        this._next();\n      });\n    }\n    return worker;\n  }\n  _returnWorker(worker) {\n    this._workerPool.push(worker);\n  }\n  _complete(data) {\n    if (data.error !== void 0) {\n      this._resolveHash[data.uuid].reject(data.error);\n    } else {\n      this._resolveHash[data.uuid].resolve(data.data);\n    }\n    this._resolveHash[data.uuid] = null;\n  }\n  async _run(id, args) {\n    await this._initWorkers();\n    const promise = new Promise((resolve, reject) => {\n      this._queue.push({ id, arguments: args, resolve, reject });\n    });\n    this._next();\n    return promise;\n  }\n  _next() {\n    if (!this._queue.length)\n      return;\n    const worker = this._getWorker();\n    if (!worker) {\n      return;\n    }\n    const toDo = this._queue.pop();\n    const id = toDo.id;\n    this._resolveHash[UUID] = { resolve: toDo.resolve, reject: toDo.reject };\n    worker.postMessage({\n      data: toDo.arguments,\n      uuid: UUID++,\n      id\n    });\n  }\n}\nconst WorkerManager = new WorkerManagerClass();\n\nexport { WorkerManager };\n//# sourceMappingURL=WorkerManager.mjs.map\n"],"names":["UUID","MAX_WORKERS","WorkerManagerClass","resolve","worker","WorkerInstance","event","src","asset","_a","WorkerInstance$1","data","id","args","promise","reject","toDo","WorkerManager"],"mappings":";;AAIA,IAAIA,IAAO,GACPC;AACJ,MAAMC,EAAmB;AAAA,EACvB,cAAc;AACZ,SAAK,eAAe,IACpB,KAAK,kBAAkB,GACvB,KAAK,cAAc,IACnB,KAAK,SAAS,IACd,KAAK,eAAe;EACrB;AAAA,EACD,yBAAyB;AACvB,WAAI,KAAK,4BAA4B,SAC5B,KAAK,2BACd,KAAK,0BAA0B,IAAI,QAAQ,CAACC,MAAY;AACtD,YAAM,EAAE,QAAAC,EAAM,IAAK,IAAIC;AACvB,MAAAD,EAAO,iBAAiB,WAAW,CAACE,MAAU;AAC5C,QAAAF,EAAO,UAAS,GAChBC,EAAe,gBAAe,GAC9BF,EAAQG,EAAM,IAAI;AAAA,MAC1B,CAAO;AAAA,IACP,CAAK,GACM,KAAK;AAAA,EACb;AAAA,EACD,gBAAgBC,GAAKC,GAAO;;AAC1B,WAAO,KAAK,KAAK,mBAAmB,CAACD,IAAKE,IAAAD,KAAA,gBAAAA,EAAO,SAAP,gBAAAC,EAAa,SAAS,CAAC;AAAA,EAClE;AAAA,EACD,MAAM,eAAe;AACnB,IAAI,KAAK,iBAET,KAAK,eAAe;AAAA,EACrB;AAAA,EACD,aAAa;AACX,IAAIR,MAAgB,WAClBA,IAAc,UAAU,uBAAuB;AAEjD,QAAIG,IAAS,KAAK,YAAY,IAAG;AACjC,WAAI,CAACA,KAAU,KAAK,kBAAkBH,MACpC,KAAK,mBACLG,IAAS,IAAIM,EAAkB,EAAC,QAChCN,EAAO,iBAAiB,WAAW,CAACE,MAAU;AAC5C,WAAK,UAAUA,EAAM,IAAI,GACzB,KAAK,cAAcA,EAAM,MAAM,GAC/B,KAAK,MAAK;AAAA,IAClB,CAAO,IAEIF;AAAA,EACR;AAAA,EACD,cAAcA,GAAQ;AACpB,SAAK,YAAY,KAAKA,CAAM;AAAA,EAC7B;AAAA,EACD,UAAUO,GAAM;AACd,IAAIA,EAAK,UAAU,SACjB,KAAK,aAAaA,EAAK,IAAI,EAAE,OAAOA,EAAK,KAAK,IAE9C,KAAK,aAAaA,EAAK,IAAI,EAAE,QAAQA,EAAK,IAAI,GAEhD,KAAK,aAAaA,EAAK,IAAI,IAAI;AAAA,EAChC;AAAA,EACD,MAAM,KAAKC,GAAIC,GAAM;AACnB,UAAM,KAAK;AACX,UAAMC,IAAU,IAAI,QAAQ,CAACX,GAASY,MAAW;AAC/C,WAAK,OAAO,KAAK,EAAE,IAAAH,GAAI,WAAWC,GAAM,SAAAV,GAAS,QAAAY,EAAM,CAAE;AAAA,IAC/D,CAAK;AACD,gBAAK,MAAK,GACHD;AAAA,EACR;AAAA,EACD,QAAQ;AACN,QAAI,CAAC,KAAK,OAAO;AACf;AACF,UAAMV,IAAS,KAAK;AACpB,QAAI,CAACA;AACH;AAEF,UAAMY,IAAO,KAAK,OAAO,IAAG,GACtBJ,IAAKI,EAAK;AAChB,SAAK,aAAahB,CAAI,IAAI,EAAE,SAASgB,EAAK,SAAS,QAAQA,EAAK,UAChEZ,EAAO,YAAY;AAAA,MACjB,MAAMY,EAAK;AAAA,MACX,MAAMhB;AAAA,MACN,IAAAY;AAAA,IACN,CAAK;AAAA,EACF;AACH;AACK,MAACK,IAAgB,IAAIf,EAAkB;","x_google_ignoreList":[0]}